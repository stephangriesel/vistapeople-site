---
export interface Props {
  post: any;
}

const { post } = Astro.props;
---

<section
  id="careers"
  class="pt-20 pb-12 lg:pt-[120px] lg:pb-[90px] dark:bg-dark"
>
  <div class="container mx-auto">
    <div class="mb-12 max-w-[510px] mx-auto text-center lg:mb-[70px]">
      <span class="mb-2 block text-lg font-semibold text-primary">
        {post.frontmatter.title}
      </span>
      <h2
        class="mb-5 text-3xl font-bold leading-tight text-dark dark:text-white sm:text-[40px] sm:leading-[1.2]"
      >
        {post.frontmatter.subtitle}
      </h2>
      <p class="text-base text-body-color dark:text-dark-6">
        {post.frontmatter.description1}
      </p>
      <p class="text-base text-body-color dark:text-dark-6 mt-4">
        {post.frontmatter.description2}
      </p>
    </div>

    <div class="max-w-3xl mx-auto">
      <div
        class="bg-white dark:bg-dark-2 border border-gray-200 dark:border-dark-3 rounded-lg p-8 shadow-lg"
      >
        <style>
          .ml-form-embedSubmitLoad {
            display: inline-block;
            width: 20px;
            height: 20px;
          }
          .ml-form-embedSubmitLoad:after {
            content: " ";
            display: block;
            width: 11px;
            height: 11px;
            margin: 1px;
            border-radius: 50%;
            border: 4px solid #fff;
            border-color: #ffffff #ffffff #ffffff transparent;
            animation: ml-form-embedSubmitLoad 1.2s linear infinite;
          }
          @keyframes ml-form-embedSubmitLoad {
            0% {
              transform: rotate(0deg);
            }
            100% {
              transform: rotate(360deg);
            }
          }
        </style>
        <div
          id="mlb2-33805085"
          class="ml-form-embedContainer ml-subscribe-form ml-subscribe-form-33805085"
        >
          <div class="ml-form-align-center">
            <div class="ml-form-embedWrapper embedForm">
              <div class="ml-form-embedBody ml-form-embedBodyDefault row-form">
                <div class="ml-form-embedContent" style="margin-bottom: 0px;">
                </div>
                <form
                  class="ml-block-form"
                  action="https://assets.mailerlite.com/jsonp/1943409/forms/172040872652702748/subscribe"
                  data-code=""
                  method="post"
                  target="_blank"
                >
                  <div class="ml-form-formContent space-y-6">
                    <div class="ml-form-fieldRow">
                      <div
                        class="ml-field-group ml-field-name ml-validate-required"
                      >
                        <label
                          for="name"
                          class="block mb-2 text-sm font-medium text-dark dark:text-white"
                          >Full Name</label
                        >
                        <!-- input -->
                        <input
                          aria-label="name"
                          aria-required="true"
                          type="text"
                          class="w-full p-3 rounded-lg bg-gray-50 dark:bg-dark-3 border border-stroke dark:border-dark-4 focus:border-primary focus:outline-none transition-colors"
                          data-inputmask=""
                          name="fields[name]"
                          placeholder="Full Name"
                          autocomplete="given-name"
                          required
                        />
                        <!-- /input -->
                      </div>
                    </div><div class="ml-form-fieldRow ml-last-item">
                      <div
                        class="ml-field-group ml-field-email ml-validate-email ml-validate-required"
                      >
                        <label
                          for="email"
                          class="block mb-2 text-sm font-medium text-dark dark:text-white"
                          >Email Address</label
                        >
                        <!-- input -->
                        <input
                          aria-label="email"
                          aria-required="true"
                          type="email"
                          class="w-full p-3 rounded-lg bg-gray-50 dark:bg-dark-3 border border-stroke dark:border-dark-4 focus:border-primary focus:outline-none transition-colors"
                          data-inputmask=""
                          name="fields[email]"
                          placeholder="Email"
                          autocomplete="email"
                          required
                        />
                        <!-- /input -->
                      </div>
                    </div>
                  </div>

                  <input type="hidden" name="ml-submit" value="1" />

                  <div class="ml-form-embedSubmit mt-6">
                    <button
                      type="submit"
                      class="w-full font-bold py-3 px-6 rounded-lg bg-primary text-white hover:bg-blue-dark transition-colors"
                    >
                      Subscribe
                    </button>

                    <button
                      disabled="disabled"
                      style="display: none;"
                      type="button"
                      class="loading w-full font-bold py-3 px-6 rounded-lg bg-primary text-white"
                    >
                      <div class="ml-form-embedSubmitLoad"></div>
                      <span class="sr-only">Loading...</span>
                    </button>
                  </div>

                  <input type="hidden" name="anticsrf" value="true" />
                </form>
              </div>

              <div
                class="ml-form-successBody row-success"
                style="display: none"
              >
                <div class="ml-form-successContent text-center">
                  <h4 class="mb-4 text-2xl font-bold text-dark dark:text-white">
                    Thank you!
                  </h4>

                  <p class="text-base text-body-color dark:text-dark-6">
                    You have successfully joined our subscriber list.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div
          class="mt-8 text-center border-t border-gray-200 dark:border-dark-3 pt-6"
        >
          <p class="text-base text-body-color dark:text-dark-6">
            Also remember to follow our <a
              href="https://www.linkedin.com/company/vistapeople"
              target="_blank"
              rel="noopener noreferrer"
              class="text-primary hover:underline">LinkedIn page</a
            > for up to date developments.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<script is:inline>
  function ml_webform_success_33805085(data) {
    // Debugging: Log the response data
    console.log("MailerLite Response:", data);

    var formContainer = document.querySelector(".ml-subscribe-form-33805085");
    if (!formContainer) return;

    var formRow = formContainer.querySelector(".row-form");
    var successRow = formContainer.querySelector(".row-success");
    var form = formContainer.querySelector("form");
    var submitBtn = form.querySelector('button[type="submit"]');
    var loadingBtn = form.querySelector("button.loading");

    // Check if the submission was successful
    if (data && data.success) {
      if (formRow && successRow) {
        formRow.style.display = "none";
        successRow.style.display = "block";
      }
    } else {
      // Handle error
      console.error("MailerLite Submission Error:", data);
      alert(
        "Something went wrong. Please check your details and try again.\n" +
          (data && data.errors ? JSON.stringify(data.errors) : ""),
      );

      // Reset buttons
      if (submitBtn) submitBtn.style.display = "block";
      if (loadingBtn) loadingBtn.style.display = "none";
    }
  }

  document.addEventListener("DOMContentLoaded", function () {
    var form = document.querySelector(".ml-subscribe-form-33805085 form");
    if (!form) return;

    // Fetch the 'takel' endpoint as per the new snippet
    fetch(
      "https://assets.mailerlite.com/jsonp/1943409/forms/172040872652702748/takel",
    );

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      var submitBtn = form.querySelector('button[type="submit"]');
      var loadingBtn = form.querySelector("button.loading");

      if (submitBtn) submitBtn.style.display = "none";
      if (loadingBtn) loadingBtn.style.display = "block";

      var formData = new FormData(form);
      var params = new URLSearchParams();

      for (var pair of formData.entries()) {
        params.append(pair[0], pair[1]);
      }

      params.append("callback", "ml_webform_success_33805085");
      params.append("_", new Date().getTime());

      var script = document.createElement("script");
      script.src = form.action + "?" + params.toString();

      script.onerror = function () {
        alert("Something went wrong. Please try again later.");
        if (submitBtn) submitBtn.style.display = "block";
        if (loadingBtn) loadingBtn.style.display = "none";
      };

      document.body.appendChild(script);
    });
  });
</script>
